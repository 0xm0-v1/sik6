#!/usr/bin/env sh
. "$(git rev-parse --show-toplevel)/.husky/project-env"

echo "▶ Format FE (lint-staged)…"
npx lint-staged
FE_FORMAT_STATUS=$?

echo "▶ Format Go (staged only, via gofumpt)…"
GO_FILES=$(git diff --name-only --cached -- '*.go')
if [ -n "$GO_FILES" ]; then
  echo "$GO_FILES" | xargs gofumpt -w
  echo "$GO_FILES" | xargs git add
fi
GO_FORMAT_STATUS=$?

echo "▶ Lints Go…"
make lint
BACKEND_STATUS=$?

echo "▶ Lints FE…"
npm run lint
FRONTEND_STATUS=$?

if [ $FE_FORMAT_STATUS -ne 0 ] || [ $GO_FORMAT_STATUS -ne 0 ] || [ $BACKEND_STATUS -ne 0 ] || [ $FRONTEND_STATUS -ne 0 ]; then
  echo "❌ Pre-commit checks failed."
  exit 1
fi

echo "✅ Pre-commit checks passed."
